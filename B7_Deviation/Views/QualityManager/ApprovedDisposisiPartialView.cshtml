<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <table class="table table-bordered table-hover nowrap table-responsive" id="deviationdatatable" width="100%">
                            <thead>
                                <tr>
                                    <th rowspan="2">No</th>
                                    <th rowspan="2">Usulan Tindakan Remedial</th>
                                    <th rowspan="2">Hasil Tindakan Remedial</th>
                                    <th colspan="4" style="text-align:center">Testing Cost</th>
                                    <th colspan="3" style="text-align:center">Processing Cost</th>
                                    <th colspan="3" style="text-align:center">Reject Cost</th>
                                    <th colspan="2" style="text-align:center">Machine Cost</th>
                                    <th rowspan="2" style="text-align:center">PIC</th>
                                    <th rowspan="2" style="text-align:center">Action</th>
                                </tr>
                                <tr>
                                    <th>Jumlah Personel</th>
                                    <th>Durasi Pengerjaan (Jam)</th>
                                    <th>Manhours Value</th>
                                    <th>Cost of Analysis</th>
                                    <th>Durasi Pengerjaan</th>
                                    <th>Jumlah Pelaksana (Jam)</th>
                                    <th>Manhours Value</th>
                                    <th>Material</th>
                                    <th>Quantity</th>
                                    <th>Cost Material</th>
                                    <th>Nama Sparepart</th>
                                    <th>Harga Sparepart</th>
                                    <th hidden="hidden">NIK PIC</th>
                                </tr>

                            </thead>
                            <tbody id="deviationtable" class="">
                            </tbody>
                            <tfoot id="picfooter">
                                <tr>
                                    <th colspan="3" rowspan="2" style="text-align: center; background-color: #f3f3f3; vertical-align: middle">Total</th>
                                    <th colspan="3" style="text-align: center ; background-color: #f3f3f3">Total Testing Manhours</th>
                                    <th style="text-align: center ; background-color: #f3f3f3">Total Testing Cost</th>
                                    <th colspan="3" style="text-align: center ; background-color: #f3f3f3">Total Processing Manhours</th>
                                    <th colspan="3" style="text-align: center ; background-color: #f3f3f3">Total Rejected Cost</th>
                                    <th colspan="2" style="text-align: center ; background-color: #f3f3f3">Total Machine Cost</th>
                                </tr>

                            </tfoot>


                        </table>

                    </div>
                </div>
                <div class="card" id="tabel2" hidden="hidden">
                    <div class="card-body">
                        <table class="table table-bordered table-hover verticle-middle table-responsive" id="buktidatatable" width="100%">
                            <thead>
                                <tr>
                                    <th width="75px">No</th>
                                    <th width="100px">NIK PIC</th>
                                    <th width="75px">Nama File</th>

                                </tr>
                            </thead>
                            <tbody id="buktitable" class="nowrap">
                            </tbody>
                        </table>

                    </div>
                </div>

            </div>
        </div>
    </div>
</body>

<script>

	function LoadData() {

		var nomor = @ViewBag.nomor;
		var dto = {
			REQID: nomor
        }
        console.log('halo');
        console.log(dto);
		$.when(
            $.ajax({
                url: "../Koordinator/Coor_LoadPICData",
                type: "post",
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    console.log(data);
                    var trHTML = '';
                    var trav = 0;
                    var Count = data.length;
                    for (trav = 0; trav < Count; trav++) {
                        var counter = 1;
                        counter += trav;
                        trHTML +=
                            '<tr><td align="center">' + counter + '</td>' +
                            '<td>' + data[trav].KETERANGAN_DISPOSISI + '</td>' +
                            '<td>' + data[trav].HASIL_TINDAKAN + '</td>' +
                            '<td>' + data[trav].TESTING_JUMLAH_PELAKSANA + '</td>' +
                            '<td>' + data[trav].TESTING_DURASI_PENGERJAAN + '</td>' +
                            //'<td>' + data[trav].TESTING_DURASI_PENGERJAAN * data[trav].TESTING_JUMLAH_PELAKSANA  + '</td>' +
                            '<td>' + data[trav].MANHOURS_VALUE_TESTING + '</td>' +
                            '<td>' + data[trav].TESTING_COST_OF_ANALYSIS + '</td>' +
                            '<td>' + data[trav].PROC_DURASI_PENGERJAAN + '</td>' +
                            '<td>' + data[trav].PROC_JUMLAH_PELAKSANA + '</td>' +
                            //'<td>' + data[trav].PROC_DURASI_PENGERJAAN * data[trav].PROC_JUMLAH_PELAKSANA + '</td>' +
                            '<td>' + data[trav].MANHOURS_VALUE_PROCESSING + '</td>' +
                            '<td>' + data[trav].REJ_MATERIAL + '</td>' +
                            '<td>' + data[trav].REJ_QUANTITY + '</td>' +
                            '<td>' + data[trav].REJ_COST_MATERIAL + '</td>' +
                            '<td>' + data[trav].MC_SPAREPART + '</td>' +
                            '<td>' + data[trav].MC_TOTAL_HARGA_SPAREPART + '</td>' +
                            '<td>' + data[trav].PIC_REMEDIAL_NAME + '</td>' +
                            '<td hidden="hidden">' + data[trav].PIC_REMEDIAL_NIK + '</td>';

                        if (data[trav].FLAG_PIC == 'REJECTED' || data[trav].FLAG_PIC == null) {
                            trHTML +=
                                '<td> - </td></tr>';

                        } else {
                            trHTML +=
                                '<td align="center"><button onclick="ShowBukti(this)" class="btn btn-info"><span class="fa fa-info"><strong></strong></span></button ></td ></tr>';

                        }
                    }

                    $('#deviationdatatable').DataTable().clear().destroy();
                    $('#deviationtable').empty();
                    $('#deviationtable').append(trHTML);
                    $('#deviationdatatable').DataTable({
                        "searching": false,
                        "paging": false,
                        "info": false,
                        "ordering": false
                    });
                },
                error: function (ex) {
                    alert(JSON.stringify(ex));
                }
            })
		).done(
            $.ajax({
                url: "../Koordinator/Coor_LoadPICDataFooter",
                type: "post",
                data: JSON.stringify(dto),
                dataType: "json",
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    var trHTML = '';
                    var trav = 0;
                    var Count = data.length;
                    for (trav = 0; trav < Count; trav++) {

                        trHTML +=
                            '<tr><td colspan="3" style="text-align:center">' + data[0].TOTAL_TESTING_MANHOURS + '</td>' +
                            '<td colspan="1" style="text-align:center">Rp ' + data[0].TOTAL_TESTING_COA + '</td>' +
                            '<td colspan="3" style="text-align:center">' + data[0].TOTAL_PROC_MAHOURS + '</td>' +
                            '<td colspan="3" style="text-align:center">Rp ' + data[0].TOTAL_REJ_COST + '</td>' +
                            '<td colspan="2" style="text-align:center">Rp ' + data[0].TOTAL_MC_HARGA_SPAREPART + '</td></tr>' +


                            //'<tr><th colspan="13" style="text-align:center; background-color: #f3f3f3">Total Times</th>' +
                            //'<td colspan="2"  style="text-align:center">' + data[trav].TOTAL_TIMES + '</td></tr>' +

                            //'<tr><th colspan="13" style="text-align:center; background-color: #f3f3f3">Total Cost</th>' +
                            //'<td colspan="2"  style="text-align:center">' + data[trav].TOTAL_COST +'</td></tr>';

                            '<tr><th colspan = "13" style="text-align:center;background-color: #f3f3f3">Total Times</th>' +
                            '<td colspan="2" style="text-align:center">' + data[trav].TOTAL_TIMES + '</td></tr>' +

                            '<tr><th colspan = "13" style="text-align:center;background-color: #f3f3f3">Total Cost</th>' +
                            '<td colspan="2" style="text-align:center"> Rp. ' + data[trav].TOTAL_COST + '</td></tr>';


                    }

                    // NO NEED TO DECLARE DATA TABLE COZ FOOTER IS FOOTER AND THE TABLE IS NOT GONNA CHANGE ANYWAY
                    $('#picfooter').append(trHTML);


                },
                error: function (ex) {
                    alert(JSON.stringify(ex));
                }
            })
		);
	};
</script>